<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>Lock NodesIntroduced in 2025.09</title>
<style>body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 0 20px; }</style>
</head>
<body>
<p><strong>类别:</strong> Data modification operators</p>
<p><strong>来源:</strong> <a href='https://neo4j.com/docs/cypher-manual/25/planning-and-tuning/operators/operators-detail/#query-plan-lock-nodes'>https://neo4j.com/docs/cypher-manual/25/planning-and-tuning/operators/operators-detail/#query-plan-lock-nodes</a></p>
<hr>
<h3 class="header-label-container" id="query-plan-lock-nodes"><a class="anchor" href="#query-plan-lock-nodes"></a>Lock Nodes<div class="labels"><span class="label content-label label--new">Introduced in 2025.09</span></div></h3>
<div class="paragraph">
<p>The <code>LockNodes</code> operator is sometimes used in conjunction with the <a href="#query-plan-locking-merge"><code>LockingMerge</code></a> operator to lock nodes.</p>
</div>
<div class="exampleblock">
<div class="title">Example 113. LockNodes</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">PROFILE
MATCH (s:Person {name: 'me'})
MERGE (s)-[:FRIENDS_WITH]-&gt;(t:Person {size: size([()--&gt;()|1])})</code></pre>
</div>
</div>
<div class="listingblock queryplan">
<div class="title">Query Plan</div>
<div class="content">
<pre>Planner COST

Runtime PIPELINED

Runtime version 2025.11

Batch size 4

+----------------------------------------+----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator                               | Id | Details                                                                                              | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Pipeline            |
+----------------------------------------+----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults                        |  0 |                                                                                                      |              1 |    0 |       0 |              0 |                    0/0 |     0.018 |                     |
| |                                      +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+                     |
| +EmptyResult                           |  1 |                                                                                                      |              1 |    0 |       0 |                |                    0/0 |     0.016 | In Pipeline 7       |
| |                                      +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Apply                                 |  2 |                                                                                                      |              1 |    0 |       0 |                |                    0/0 |           |                     |
| |\                                     +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +ArgumentTracker                     | 19 |                                                                                                      |              1 |    0 |       0 |            240 |                    0/0 |     0.000 |                     |
| | |                                    +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+                     |
| | +LockingMerge                        |  3 | CREATE (t:Person {size: COUNT {   MATCH (`anon_2`)-[`anon_3`]-&gt;(`anon_4`)   RETURN $`autoint_1` AS ` |              1 |    1 |       3 |            400 |                    0/0 |    15.340 | In Pipeline 7       |
| | |                                    |    | anon_0` }}), (s)-[anon_1:FRIENDS_WITH]-&gt;(t), LOCK(s)                                                 |                |      |         |                |                        |           |                     |
| | |                                    +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +AntiConditionalApply                | 18 |                                                                                                      |                |    0 |       0 |            384 |                        |     0.010 | In Pipeline 6       |
| | |\                                   +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | | +Filter                            | 17 | t.size = anon_5 AND t:Person                                                                         |              0 |    0 |       4 |                |                        |           |                     |
| | | |                                  +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+                        |           |                     |
| | | +Apply                             | 16 |                                                                                                      |              1 |    2 |       0 |                |                        |           |                     |
| | | |\                                 +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+                        |           |                     |
| | | | +RelationshipCountFromCountStore | 15 | count( ()-[]-&gt;() ) AS anon_5                                                                         |              1 |    2 |       2 |            608 |                    0/0 |     0.113 | Fused in Pipeline 5 |
| | | |                                  +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | | +Expand(All)                       | 14 | (s)-[anon_1:FRIENDS_WITH]-&gt;(t)                                                                       |              1 |    2 |       3 |                |                        |           |                     |
| | | |                                  +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+                        |           |                     |
| | | +LockNodes                         | 13 | s                                                                                                    |              1 |    1 |       0 |                |                        |           |                     |
| | | |                                  +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+                        |           |                     |
| | | +Argument                          | 12 | s                                                                                                    |              1 |    1 |       0 |            584 |                    0/0 |     1.494 | Fused in Pipeline 4 |
| | |                                    +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Optional                            | 11 | s                                                                                                    |              0 |    1 |       0 |            528 |                    0/0 |     2.057 | In Pipeline 3       |
| | |                                    +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Filter                              |  5 | t.size = anon_5 AND t:Person                                                                         |              0 |    0 |       4 |                |                        |           |                     |
| | |                                    +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+                        |           |                     |
| | +Apply                               |  6 |                                                                                                      |              1 |    2 |       0 |                |                        |           |                     |
| | |\                                   +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+                        |           |                     |
| | | +RelationshipCountFromCountStore   |  7 | count( ()-[]-&gt;() ) AS anon_5                                                                         |              1 |    2 |       2 |            528 |                    0/0 |     4.220 | Fused in Pipeline 2 |
| | |                                    +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Expand(All)                         |  8 | (s)-[anon_1:FRIENDS_WITH]-&gt;(t)                                                                       |              1 |    2 |       3 |                |                        |           |                     |
| | |                                    +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+                        |           |                     |
| | +Argument                            |  9 | s                                                                                                    |              1 |    1 |       0 |            432 |                    1/0 |     0.184 | Fused in Pipeline 1 |
| |                                      +----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeIndexSeek                         | 10 | RANGE INDEX s:Person(name) WHERE name = $autostring_0                                                |              1 |    1 |       2 |            376 |                    0/1 |     9.263 | In Pipeline 0       |
+----------------------------------------+----+------------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 23, total allocated memory: 3248</pre>
</div>
</div>
</div>
</div>
</body>
</html>